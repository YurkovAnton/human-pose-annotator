<html>
<head>
  <script type="text/javascript" src="graph-annotator.js"></script>
  <script type="text/javascript" src="definitions.js"></script>
  <style type="text/css">
    body {
      font-family: Verdana, Arial, sans-serif;
    }
    .inline-block {
      display: inline-block;
      vertical-align: top;
      white-space: normal;
    }
   .button {
      background-color: #008080;
      border: none;
      color: white;
      padding: 8px 17px;
      font-size: 18px;
      margin: 0px 5px;
      cursor: pointer;
    }
    .button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    #message {
        font-size: 18;
        color: black;
        text-align: left;
        font-weight: bold;
    }
    p {
        font-size: 18;
        color: black;
        text-align: center;
        font-weight: bold;
    }
  </style>
</head>
<body>
  <div style="white-space:nowrap;">
    <div id="annotator" style="margin:20 1.5em;"></div>
    <div class="inline-block" style="margin:0 1em;">
      <h2>Human Pose Annotator</h2>
      <p id="message" class="message"></p>
      <div style="white-space:nowrap;">
        <div class="inline-block" style="margin:0 1.5em;">
          <p>Front</p>
          <div id="example-front"></div>
        </div>
        <div class="inline-block">
          <p>Back</p>
          <div id="example-back"></div>
        </div>
      </div>
      <p>
        <button id="clear-button" class="button">Clear</button>
        <button id="prev-button" class="button" disabled="disabled" style="margin:0 5px;">Prev</button>
        <button id="next-button" class="button">Next</button>
        <button id="download-button" class="button" style="margin:0 5px;">Export</button>
      </p>
    </div>
  </div>
  <script type="text/javascript">
    var image_num = 0;
    nodeColor = function(which) { return (which == 1) ? [255, 255, 255] : [255, 255, 0];}
    nodeVisibility = function(which) { return (which == 1) ? 1 : 0;}
    
    window.onload = function() {
      example1 = createExample(document, 'tshirt_front.png', example1_nodes, 'front');
      example2 = createExample(document, 'tshirt_back.png', example2_nodes, 'back');
      
      // Create a main annotation.
      var annotator = creatAnnotator(document, ++image_num, example1, example2);
      
      /* Set up the Clear button */
      document.getElementById('clear-button').addEventListener('click', function(event) {
        annotator.setNodeAttributes({position: undefined});
        example1.setNodeAttributes({color: null, diameter: 3});
        example2.setNodeAttributes({color: null, diameter: 3});
        example1.setNodeAttributes(0, {color: [255, 0, 0], diameter:5});
        example2.setNodeAttributes(0, {color: [255, 0, 0], diameter:5});
        //document.getElementById('download-button').setAttribute('disabled', 'disabled');
        document.getElementById('message').innerHTML = '&lt;&lt; Click ' + nodes[0].name.substr(0, 1).toUpperCase() + nodes[0].name.substr(1);
      });
      
      /* Set up the Export button */
      document.getElementById('download-button').addEventListener('click', function(event) {
        var anchor = document.createElement('a');
        if (graph_array.length == image_num-1){
            graph_array.push(deepCopy(graph));
        } else {
            graph_array[image_num-1] = deepCopy(graph);
        }
        var dataURL = 'data:application/json;charset=utf-8,' +
                      encodeURIComponent(JSON.stringify(graph_array));
                           
        anchor.setAttribute('download', 'graph.json');
        anchor.setAttribute('href', dataURL);
        anchor.style.display = 'none';
        document.body.appendChild(anchor);
        anchor.click();
        document.body.removeChild(anchor);
      });
      
      /* TODO если finished то поменятьв табло число сделанных разметок */
      /* Set up the Next button */
      document.getElementById('next-button').addEventListener('click', function(event) {
        if (graph_array.length == image_num-1){
            graph_array.push(deepCopy(graph));
        } else {
            graph_array[image_num-1] = deepCopy(graph);
        }
        document.getElementById('clear-button').click();
        
        annotator = creatAnnotator(document, ++image_num, example1, example2);
                                                              
        if (image_num == 10){
            document.getElementById('next-button').setAttribute('disabled', 'disabled');
        } else if (image_num == 2){
            document.getElementById('prev-button').removeAttribute('disabled', 'disabled');
        }
      });
      
      /* Set up the Prev button */
      document.getElementById('prev-button').addEventListener('click', function(event) {
        if (graph_array.length == image_num-1){
            graph_array.push(deepCopy(graph));
        } else {
            graph_array[image_num-1] = deepCopy(graph);
        }
        document.getElementById('clear-button').click();
        
        annotator = creatAnnotator(document, --image_num, example1, example2);

        if (image_num == 1){
            document.getElementById('prev-button').setAttribute('disabled', 'disabled');
        } else if (image_num == 9) {
            document.getElementById('next-button').removeAttribute('disabled', 'disabled');
        }
      });
    }
  </script>
</body>
</html>